- name: Bootstrap Kubernetes worker nodes
  hosts: node1:node2
  become: true
  gather_facts: true
  vars_files:
    - "{{ playbook_dir }}/vars/etcd.yml"
    - "{{ playbook_dir }}/vars/tls.yml"
  tasks:
    - name: Import role bootstrap
      ansible.builtin.include_role:
        name: bootstrap
    - name: Import tls role
      ansible.builtin.include_role:
        name: tls
    - name: Import kubeconfig role
      ansible.builtin.include_role:
        name: kubeconfig
      vars:
        apiserver_ip: "[{{ ansible_facts.all_ipv6_addresses[-1] }}]"
    - name: Import etcd role
      ansible.builtin.include_role:
        name: etcd
